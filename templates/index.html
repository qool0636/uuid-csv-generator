{% extends "bootstrap/base.html" %}

{% block title %}UUID CSV 檔案生成器{% endblock %}

{% block styles %}
{{super()}}
<style>
    .container {
        max-width: 800px;
        margin-top: 50px;
    }
    .result {
        margin-top: 20px;
        display: none;
    }
    .loading {
        display: none;
        text-align: center;
        margin: 20px 0;
    }
    .error {
        color: red;
        margin-top: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center">UUID CSV 檔案生成器</h1>
    
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <form id="uuidForm" class="form-horizontal">
                <div class="form-group">
                    <label for="uuid" class="col-sm-2 control-label">UUID</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="uuid" name="uuid" placeholder="請輸入 UUID">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-primary">生成檔案</button>
                    </div>
                </div>
            </form>
            
            <div class="loading">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">載入中...</span>
                </div>
                <p>正在生成檔案，請稍候...</p>
            </div>
            
            <div class="result">
                <h3>檔案已生成：</h3>
                <ul id="fileList" class="list-group">
                </ul>
            </div>
            
            <div class="error" id="errorMessage"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{super()}}
<script>
document.getElementById('uuidForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const uuid = document.getElementById('uuid').value;
    const loading = document.querySelector('.loading');
    const result = document.querySelector('.result');
    const errorMessage = document.getElementById('errorMessage');
    const fileList = document.getElementById('fileList');
    
    // 重置顯示
    loading.style.display = 'block';
    result.style.display = 'none';
    errorMessage.textContent = '';
    fileList.innerHTML = '';
    
    // 發送請求
    fetch('/generate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `uuid=${encodeURIComponent(uuid)}`
    })
    .then(response => response.json())
    .then(data => {
        loading.style.display = 'none';
        
        if (data.success) {
            result.style.display = 'block';
            data.files.forEach(file => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.innerHTML = `
                    <a href="/download/${file}" class="btn btn-sm btn-success pull-right">下載</a>
                    ${file}
                `;
                fileList.appendChild(li);
            });
        } else {
            errorMessage.textContent = data.message;
        }
    })
    .catch(error => {
        loading.style.display = 'none';
        errorMessage.textContent = '發生錯誤，請稍後再試';
    });
});
</script>
{% endblock %} 